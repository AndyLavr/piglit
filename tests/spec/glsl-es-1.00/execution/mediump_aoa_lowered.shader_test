# Tests that an operation involving array-of-array derefs in mediump
# is performed using lowered precision. Note that doing the operation
# in a higher precision is valid according to the spec so this test
# canâ€™t be used in production. It is only for development.

[require]
GL ES >= 3.1
GLSL ES >= 3.10

[vertex shader passthrough]

[fragment shader]
#version 310 es
precision mediump float;

uniform float in_aoa[2][2];
uniform int i0;
uniform int i1;

layout(location = 0) out vec4 out_color;

void main()
{
    /* In r component, simple array deref */
    out_color.r = fract(in_aoa[0][0] / in_aoa[1][1] * 1024.0);
    /* In g component, array deref with non-const index */
    out_color.g = fract(in_aoa[i0][i0] / in_aoa[i1][i1] * 1024.0);
    /* In b component, embedded deref with array */
    out_color.b = 0.0;
    out_color.a = 1.0;
}

[test]

uniform float in_aoa[0][0] 1.0
uniform float in_aoa[1][1] 3.0

uniform int i0 0
uniform int i1 1

draw rect -1 -1 2 2
probe all rgba 0.25 0.25 0.0 1.0
