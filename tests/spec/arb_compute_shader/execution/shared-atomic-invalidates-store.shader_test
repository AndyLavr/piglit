# Verify that a SSBO atomic instruction invalidates a previous matching store

[require]
GL >= 3.3
ES >= 3.1
GLSL >= 3.30
GL_ARB_compute_shader
GL_ARB_shader_atomic_counters

[compute shader]
#version 330
#extension GL_ARB_compute_shader: enable
#extension GL_ARB_shader_atomic_counters: enable
#extension GL_ARB_shader_storage_buffer_object: enable

layout(local_size_x = 1, local_size_y = 1, local_size_z = 1) in;

layout(binding = 0) uniform atomic_uint counter;
shared uint val;
uniform uint ref_val;

void main()
{
  val = 0u;

  atomicAdd(val, 1u);

  uint tmp = val + ref_val;

  if (tmp == ref_val + 1u)
    atomicCounterIncrement(counter);
}

[test]
atomic counters 1

uniform uint ref_val 5

compute 1 1 1
probe atomic counter 0 == 1
