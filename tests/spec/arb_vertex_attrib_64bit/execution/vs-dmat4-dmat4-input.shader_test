[require]
GLSL >= 1.50
GL_ARB_gpu_shader_fp64
GL_ARB_vertex_attrib_64bit

[vertex shader]
#version 150
#extension GL_ARB_gpu_shader_fp64 : require
#extension GL_ARB_vertex_attrib_64bit : require

uniform double tolerance;
uniform dmat4 expected1;
uniform dmat4 expected2;

in vec3 vertex;
in dmat4 value1;
in dmat4 value2;
out vec4 color;

void main()
{
  gl_Position = vec4(vertex, 1.0);
  color = vec4(0.0, 0.0, 0.0, 0.0);

  if (distance(value1[0], expected1[0]) > tolerance) {
     color.r = 0.5;
  }

  if (distance(value2[0], expected2[0]) > tolerance) {
     color.r = 1.0;
  }

  if (distance(value1[1], expected1[1]) > tolerance) {
     color.g = 0.5;
  }

  if (distance(value2[1], expected2[1]) > tolerance) {
     color.g = 1.0;
  }

  if (distance(value1[2], expected1[2]) > tolerance) {
     color.b = 0.5;
  }

  if (distance(value2[2], expected2[2]) > tolerance) {
     color.b = 1.0;
  }

  if (distance(value1[3], expected1[3]) > tolerance) {
     color.a = 0.5;
  }

  if (distance(value2[3], expected2[3]) > tolerance) {
     color.a = 1.0;
  }
}

[fragment shader]
#version 150
#extension GL_ARB_gpu_shader_fp64 : require

in vec4 color;
void main()
{
  gl_FragColor = color;
}

[vertex data]
vertex/float/3  value1/double/4/0                                                                                                                value1/double/4/1                                                                                                                        value1/double/4/2                                                                                                                         value1/double/4/3                                                                                                     value2/double/4/0                                                                 value2/double/4/1                                                                                                                         value2/double/4/2                                                                                                   value2/double/4/3
-1.0 -1.0 0.0   5.00000000000047073456244106637E0 3.50000000000727684579260312603E02 4.23559999999999980957454681629E0 1.28019883010000000922445906326E2 3.42299999999999968736119626556E1 9.30120000000000004547473508865E1 -3.99301200000000017098500393331E3 -1.9301232300000000918771547731E2 -1.90123229999999985295744409086E1 1.08332919999999994615791365504E4 -2.92311210000000020954757928848E5 8.39100000000000022737367544323E2 8.39111110000000053332769311965E2 9.21111109999999939645931590348E1 -9.21111109999999939645931590348E1 1.0E0 2.0E0 2.0110999999999998877342477499E0 8.83211E5 9.32111110000000053332769311965E2 -9.83110999999999989995558280498E2 1.93193312310000010256771929562E2 9.12211000000000058207660913467E3 -1.02102000000000003865352482535E2 -8.11111111111111071636514679994E0 -8.81928399E8 9.9801111100000002807064447552E2 2.01481019999999989522621035576E4 1.63183741999999995186954038218E2 4.33211221999999997933628037572E3 1.43321122200000008888309821486E4 8.65487999999999919964466243982E3
 1.0 -1.0 0.0   5.00000000000047073456244106637E0 3.50000000000727684579260312603E02 4.23559999999999980957454681629E0 1.28019883010000000922445906326E2 3.42299999999999968736119626556E1 9.30120000000000004547473508865E1 -3.99301200000000017098500393331E3 -1.9301232300000000918771547731E2 -1.90123229999999985295744409086E1 1.08332919999999994615791365504E4 -2.92311210000000020954757928848E5 8.39100000000000022737367544323E2 8.39111110000000053332769311965E2 9.21111109999999939645931590348E1 -9.21111109999999939645931590348E1 1.0E0 2.0E0 2.0110999999999998877342477499E0 8.83211E5 9.32111110000000053332769311965E2 -9.83110999999999989995558280498E2 1.93193312310000010256771929562E2 9.12211000000000058207660913467E3 -1.02102000000000003865352482535E2 -8.11111111111111071636514679994E0 -8.81928399E8 9.9801111100000002807064447552E2 2.01481019999999989522621035576E4 1.63183741999999995186954038218E2 4.33211221999999997933628037572E3 1.43321122200000008888309821486E4 8.65487999999999919964466243982E3
 1.0  1.0 0.0   5.00000000000047073456244106637E0 3.50000000000727684579260312603E02 4.23559999999999980957454681629E0 1.28019883010000000922445906326E2 3.42299999999999968736119626556E1 9.30120000000000004547473508865E1 -3.99301200000000017098500393331E3 -1.9301232300000000918771547731E2 -1.90123229999999985295744409086E1 1.08332919999999994615791365504E4 -2.92311210000000020954757928848E5 8.39100000000000022737367544323E2 8.39111110000000053332769311965E2 9.21111109999999939645931590348E1 -9.21111109999999939645931590348E1 1.0E0 2.0E0 2.0110999999999998877342477499E0 8.83211E5 9.32111110000000053332769311965E2 -9.83110999999999989995558280498E2 1.93193312310000010256771929562E2 9.12211000000000058207660913467E3 -1.02102000000000003865352482535E2 -8.11111111111111071636514679994E0 -8.81928399E8 9.9801111100000002807064447552E2 2.01481019999999989522621035576E4 1.63183741999999995186954038218E2 4.33211221999999997933628037572E3 1.43321122200000008888309821486E4 8.65487999999999919964466243982E3
-1.0  1.0 0.0   5.00000000000047073456244106637E0 3.50000000000727684579260312603E02 4.23559999999999980957454681629E0 1.28019883010000000922445906326E2 3.42299999999999968736119626556E1 9.30120000000000004547473508865E1 -3.99301200000000017098500393331E3 -1.9301232300000000918771547731E2 -1.90123229999999985295744409086E1 1.08332919999999994615791365504E4 -2.92311210000000020954757928848E5 8.39100000000000022737367544323E2 8.39111110000000053332769311965E2 9.21111109999999939645931590348E1 -9.21111109999999939645931590348E1 1.0E0 2.0E0 2.0110999999999998877342477499E0 8.83211E5 9.32111110000000053332769311965E2 -9.83110999999999989995558280498E2 1.93193312310000010256771929562E2 9.12211000000000058207660913467E3-1.02102000000000003865352482535E2 -8.11111111111111071636514679994E0 -8.81928399E8 9.9801111100000002807064447552E2 2.01481019999999989522621035576E4 1.63183741999999995186954038218E2 4.33211221999999997933628037572E3 1.43321122200000008888309821486E4 8.65487999999999919964466243982E3

[test]
uniform double tolerance 0.0
uniform dmat4 expected1 5.00000000000047073456244106637E0 3.50000000000727684579260312603E02 4.23559999999999980957454681629E0 1.28019883010000000922445906326E2 3.42299999999999968736119626556E1 9.30120000000000004547473508865E1 -3.99301200000000017098500393331E3 -1.9301232300000000918771547731E2 -1.90123229999999985295744409086E1 1.08332919999999994615791365504E4 -2.92311210000000020954757928848E5 8.39100000000000022737367544323E2 8.39111110000000053332769311965E2 9.21111109999999939645931590348E1 -9.21111109999999939645931590348E1 1.0E0
uniform dmat4 expected2 2.0E0 2.0110999999999998877342477499E0 8.83211E5 9.32111110000000053332769311965E2 -9.83110999999999989995558280498E2 1.93193312310000010256771929562E2 9.12211000000000058207660913467E3 -1.02102000000000003865352482535E2 -8.11111111111111071636514679994E0 -8.81928399E8 9.9801111100000002807064447552E2 2.01481019999999989522621035576E4 1.63183741999999995186954038218E2 4.33211221999999997933628037572E3 1.43321122200000008888309821486E4 8.65487999999999919964466243982E3
clear color 0.0 0.0 1.0 0.0
clear
draw arrays GL_TRIANGLE_FAN 0 4
probe rgba 0 0 0.0 0.0 0.0 0.0
